# OAuth Authentication Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         OAUTH AUTHENTICATION FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 1: User Initiates Authentication
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    User's Browser                    Your App                    Google
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€
         â”‚                                â”‚                          â”‚
         â”‚  1. Click "Connect Google      â”‚                          â”‚
         â”‚     Calendar" Button           â”‚                          â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
         â”‚                                â”‚                          â”‚
         â”‚  2. GET /api/auth/signin       â”‚                          â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
         â”‚                                â”‚                          â”‚
         â”‚  3. Redirect to Google OAuth   â”‚                          â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                                â”‚                          â”‚
                                                                      
STEP 2: User Grants Permission
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

         â”‚                                â”‚                          â”‚
         â”‚  4. Show Sign-In Page          â”‚                          â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                                â”‚                          â”‚
         â”‚  5. User Logs In               â”‚                          â”‚
         â”‚     - Email: rabjob212@gmail.com                          â”‚
         â”‚     - Grants calendar access   â”‚                          â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                                â”‚                          â”‚

STEP 3: Exchange Code for Tokens
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

         â”‚                                â”‚                          â”‚
         â”‚  6. Redirect with auth code    â”‚                          â”‚
         â”‚  /api/auth/callback/google     â”‚                          â”‚
         â”‚    ?code=abc123...             â”‚                          â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
         â”‚                                â”‚                          â”‚
         â”‚                                â”‚  7. Exchange code        â”‚
         â”‚                                â”‚     for tokens           â”‚
         â”‚                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                                â”‚                          â”‚
         â”‚                                â”‚  8. Return tokens        â”‚
         â”‚                                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                                â”‚     access_token         â”‚
         â”‚                                â”‚     refresh_token        â”‚
         â”‚                                â”‚                          â”‚
         â”‚                                â”‚  9. Store in httpOnly    â”‚
         â”‚                                â”‚     cookies              â”‚
         â”‚                                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
         â”‚                                â”‚  â”‚ google_access_  â”‚    â”‚
         â”‚                                â”‚  â”‚    token        â”‚    â”‚
         â”‚                                â”‚  â”‚ google_refresh_ â”‚    â”‚
         â”‚                                â”‚  â”‚    token        â”‚    â”‚
         â”‚                                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
         â”‚                                â”‚                          â”‚
         â”‚  10. Redirect to /?auth=success                           â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
         â”‚                                â”‚                          â”‚

STEP 4: User Creates Booking
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

         â”‚                                â”‚                          â”‚
         â”‚  11. Click time slot           â”‚                          â”‚
         â”‚      Fill booking form         â”‚                          â”‚
         â”‚      Submit                    â”‚                          â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
         â”‚  POST /api/bookings            â”‚                          â”‚
         â”‚  (cookies sent automatically)  â”‚                          â”‚
         â”‚                                â”‚                          â”‚
         â”‚                                â”‚  12. Read tokens from    â”‚
         â”‚                                â”‚      cookies             â”‚
         â”‚                                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
         â”‚                                â”‚  â”‚ Extract tokens  â”‚    â”‚
         â”‚                                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
         â”‚                                â”‚                          â”‚
         â”‚                                â”‚  13. Create calendar     â”‚
         â”‚                                â”‚      event               â”‚
         â”‚                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                                â”‚  Authorization: Bearer   â”‚
         â”‚                                â”‚    {access_token}        â”‚
         â”‚                                â”‚                          â”‚
         â”‚                                â”‚  14. Event created       â”‚
         â”‚                                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                                â”‚  {                       â”‚
         â”‚                                â”‚    id: "event123",       â”‚
         â”‚                                â”‚    htmlLink: "https://...â”‚
         â”‚                                â”‚  }                       â”‚
         â”‚                                â”‚                          â”‚
         â”‚  15. Booking confirmation      â”‚                          â”‚
         â”‚      with calendar link        â”‚                          â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
         â”‚                                â”‚                          â”‚
         â”‚  16. Customer receives         â”‚                          â”‚
         â”‚      calendar invite via email â”‚                          â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                                â”‚                          â”‚


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TOKEN LIFECYCLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Access Token (1 hour expiry)
â”œâ”€ Used for every API call to Google Calendar
â”œâ”€ Stored in httpOnly cookie
â”œâ”€ Automatically sent with requests
â””â”€ If expired â†’ Use refresh token to get new one

Refresh Token (30 days expiry)
â”œâ”€ Used to get new access tokens
â”œâ”€ Stored in httpOnly cookie
â”œâ”€ Longer lived
â””â”€ If expired â†’ User must re-authenticate


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECURITY FEATURES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ HttpOnly Cookies     â†’ Prevents XSS attacks (JS can't access tokens)
âœ“ SameSite=Lax        â†’ Prevents CSRF attacks
âœ“ Secure in Production â†’ HTTPS only
âœ“ Short-lived Access   â†’ 1 hour expiry minimizes risk
âœ“ OAuth 2.0           â†’ Industry standard authentication
âœ“ Scoped Permissions  â†’ Only calendar access, not full account


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
API ENDPOINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

GET  /api/auth/signin              â†’ Redirect to Google OAuth
GET  /api/auth/callback/google     â†’ Handle OAuth callback, store tokens
POST /api/auth/signout             â†’ Clear authentication cookies
GET  /api/auth/status              â†’ Check if user is authenticated

POST /api/bookings                 â†’ Create booking + calendar event
GET  /api/calendar/availability    â†’ Get booked time slots


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CALENDAR EVENT STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{
  "summary": "Board Game Session - 4 players",
  "description": "
    Board Game Booking
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    ğŸ‘¤ Customer: John Doe
    ğŸ“§ Email: john@example.com
    ğŸ“± Phone: +1234567890
    
    ğŸ‘¥ Number of People: 4
    
    ğŸ² Games Selected:
    Catan, Ticket to Ride, Pandemic
    
    ğŸ½ï¸ Refreshments:
    âœ“ Drinks
    âœ“ Snacks
    
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    Booking ID: booking_1234567890
  ",
  "start": {
    "dateTime": "2025-10-25T14:00:00Z",
    "timeZone": "Asia/Bangkok"
  },
  "end": {
    "dateTime": "2025-10-25T16:00:00Z",
    "timeZone": "Asia/Bangkok"
  },
  "attendees": [
    { "email": "john@example.com" }
  ],
  "reminders": {
    "useDefault": false,
    "overrides": [
      { "method": "email", "minutes": 1440 },  // 1 day before
      { "method": "popup", "minutes": 60 }     // 1 hour before
    ]
  }
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```
